#! /bin/bash

. error_handling_module.sh

echo
echo $sectionBreak
echo "          Port Scanning Module (NMAP Implementation)"
echo $sectionBreak
echo

echo -n "Would you like to scan a single target or multiple ones? (S/M): "
read targetChoice

case $targetChoice in 
M)
	echo
	echo $sectionBreak
	echo
	echo -n "Please enter the location of the file containing: "
	read location

	# Check for empty filename
	empty_check $location

	# Check for wrong/non-existent filename
	nonexistent_file_check $location;;
S)
	echo
	echo $sectionBreak
	echo
	echo "A single target/or network was chosen. Continuing....";;
*)
	echo
	echo $sectionBreak
	echo 
	echo "Invalid choice."
	echo
	read -p "Press any key to exit."
	exit;;
esac

echo
echo $sectionBreak
echo
echo "The following scans are available: "
echo "1. Port Scan"
echo "2. Ping Scan"
echo "3. OS Scan"
echo
echo -n "Enter the desired scan type number: "
read scanChoice
echo
echo $sectionBreak

case $scanChoice in
1) 
	echo
	echo -n "Please enter the port or ports to be scanned (multiple ports should be separated by commas): "
	read ports
	
	empty_check $ports
	echo    
	echo $sectionBreak

	case $targetChoice in 
	S)
		echo
		echo -n "Please enter the target whose ports you would like to scan: "
        	read target

		empty_check $target
        	echo
        	echo $sectionBreak
        	echo

        	echo "Port Scanning $target ...."
		echo
		nmap -sS -p $ports $target;;
	M)
		#Read the list and perform the scan on all listed domains
		for domain in $(cat $location); do
			echo
			echo "Port Scanning $domain ...."
			echo
			nmap -sS -p $ports $domain
			echo
			echo $sectionBreak
		done;;
	esac;;
2) 
        case $targetChoice in 
        S)
                echo
		echo -n "Please enter the network and mask or host that you would like to ping: "
                read target
		
		empty_check $target
                echo
                echo $sectionBreak
                echo

		echo "Ping Scanning $target ...."
                echo
                nmap -sn $target;;
        M)
                #Read the list and perform the ping scan on all listed domains
                for domain in $(cat $location); do
			echo
			echo "Ping Scanning $domain ...."
			echo 
			nmap -sn $domain
			echo
			echo $sectionBreak
                done;;
        esac;;
3) 
        case $targetChoice in 
        S)
                echo
		echo -n "Please enter the target whose OS you would like to identify: "
                read target
                
		empty_check $target
		echo
                echo $sectionBreak
                echo

		echo "OS Scanning $target ...."
                echo
                nmap -O $target;;
        M)
                #Read the list and perform the OS scan on all listed domains
                for domain in $(cat $location); do
			echo
			echo "OS Scanning $domain ...."
			echo 
			nmap -O $domain
			echo
			echo $sectionBreak
                done;;
        esac;;
*) 
	echo
	echo "You have an invalid choice. "
	echo
	read -p "Press any key to exit."
	exit
esac
